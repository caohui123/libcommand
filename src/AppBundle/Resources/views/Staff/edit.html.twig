{% extends '::base.html.twig' %}
{% block title %}{{ entity.firstName }} {{ entity.lastName }} &#8211; Library Staff{% endblock %}
{% block body %}
      
    {# Page Heading #}
    {% set headingvars = {'headingcontent' : 'Edit ' ~ entity.firstName ~ ' ' ~ entity.lastName } %}
    {% include 'snippets/pageHeading.html.twig' with headingvars %}
    
    {# Back button and print button #}
    {% set toolbarvars = {'basepath' : path('staff'), 'printpath' : path('staff_print', { 'id': entity.id }) } %}
    {% include 'snippets/editToolbar.html.twig' with toolbarvars %}
    
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-8">
        <table class="table table-striped table-responsive record_properties">
            {{ form_start(edit_form) }}
            <tbody>
                <tr>
                    <th>LDAP User</th>
                    <td>
                        {% if ldap_user is not null %}
                            {{ldap_user}} 
                            {% if is_granted('ROLE_ADMIN') %}
                                <a class="btn btn-default btn-xs" href="{{ path('admin') }}">Change</a> 
                            {% endif %}
                        {% else %}
                            Not Set
                            {% if is_granted('ROLE_ADMIN') %}
                                <a class="btn btn-default btn-xs" href="{{ path('admin') }}">Change</a> 
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.staffId) }}</th>
                    <td>
                        {{ form_widget(edit_form.staffId) }}
                        {{ form_errors(edit_form.staffId) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.firstName) }}</th>
                    <td>
                        {{ form_widget(edit_form.firstName) }}
                        {{ form_errors(edit_form.firstName) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.lastName) }}</th>
                    <td>
                        {{ form_widget(edit_form.lastName) }}
                        {{ form_errors(edit_form.lastName) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.employmentStatus) }}</th>
                    <td>
                        {{ form_widget(edit_form.employmentStatus) }}
                        {{ form_errors(edit_form.employmentStatus) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.jobDescription) }}</th>
                    <td>
                        {{ form_widget(edit_form.jobDescription) }}
                        {{ form_errors(edit_form.jobDescription) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.department) }}</th>
                    <td>
                        {{ form_widget(edit_form.department) }}
                        {{ form_errors(edit_form.department) }}
                        {% if is_granted('ROLE_DEPARTMENTS_EDIT') %}
                            <br>
                            <a href="{{ path('department') }}"><span class="glyphicon glyphicon-pencil"></span> Manage departments</a>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.staffFunctionalArea) }}</th>
                    <td>
                        {{ form_widget(edit_form.staffFunctionalArea) }}
                        {{ form_errors(edit_form.staffFunctionalArea) }}
                        {% if is_granted('ROLE_ADMIN') %}
                            <br>
                            <a href="{{ path('admin_staffareas') }}"><span class="glyphicon glyphicon-pencil"></span> Manage functional areas</a>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.jobTitle) }}</th>
                    <td>
                        {{ form_widget(edit_form.jobTitle) }}
                        {{ form_errors(edit_form.jobTitle) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.guidesUrl) }}</th>
                    <td>
                        {{ form_widget(edit_form.guidesUrl) }}
                        {{ form_errors(edit_form.guidesUrl) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.office) }}</th>
                    <td>
                        {{ form_widget(edit_form.office) }}
                        {{ form_errors(edit_form.office) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.phone) }}</th>
                    <td>
                        {{ form_widget(edit_form.phone) }}
                        {{ form_errors(edit_form.phone) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.email) }}</th>
                    <td>
                        {{ form_widget(edit_form.email) }}
                        {{ form_errors(edit_form.email) }}
                    </td>
                </tr>
                <tr>
                    <th>Home Address</th>
                    <td>
                        <table class="table">
                            <tr>
                                <th>Street </th><td> {{ form_widget(edit_form.homeStreet) }}{{ form_errors(edit_form.homeStreet) }}</td>
                            </tr>
                            <tr>
                                <th>City </th><td> {{ form_widget(edit_form.homeCity) }}{{ form_errors(edit_form.homeCity) }}</td>
                            </tr>
                            <tr>    
                                <th>State </th><td> {{ form_widget(edit_form.homeState) }}{{ form_errors(edit_form.homeState) }}</td>
                            </tr>
                            <tr>
                                <th>Zip </th><td> {{ form_widget(edit_form.homeZip) }}{{ form_errors(edit_form.homeZip) }}</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.homePhone) }}</th>
                    <td>
                        {{ form_widget(edit_form.homePhone) }}
                        {{ form_errors(edit_form.homePhone) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.cellPhone) }}</th>
                    <td>
                        {{ form_widget(edit_form.cellPhone) }}
                        {{ form_errors(edit_form.cellPhone) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.selfIntro) }}</th>
                    <td>
                        {{ form_widget(edit_form.selfIntro) }}
                        {{ form_errors(edit_form.selfIntro) }}
                    </td>
                </tr>
                <tr>
                    <th>{{ form_label(edit_form.favoriteWebsites) }}</th>
                    <td>
                        {{ form_widget(edit_form.favoriteWebsites) }}
                        {{ form_errors(edit_form.favoriteWebsites) }}
                    </td>
                </tr>
            </tbody>
        </table>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-4">
           <div class="panel panel-default">
                <div class="panel-heading">Current Photo</div>
                <div class="panel-body">
                    <div class="form-group">
                        <label class="control-label">Current Profile Photo</label>
                    {% if entity.image %}
                        <p><img src="{{ asset('uploads/profile/' ~ entity.image.path) | imagine_filter('large') }}" alt="{{ entity.image.path }}" title="{{ entity.image.path }}"/></p>
                        {{ form_row(edit_form.removeProfilePhotoSubmit) }}
                    {% else %}
                        <p class="alert alert-info">No profile image selected. Pick one below.</p>
                    {% endif %}
                    </div>
                    <div class="form-group" id="thumbnails-list-container">
                        <label class="control-label">Other Profile Photos</label>
                        <p>Click on the photo you wish to use. It will be set as the staff member's profile image when you update the form.</p>
                        <p>Don't see the image you're looking for? Navigate to the <a href="#new-image-form-container">New Profile Image</a> form below to add one. Also be sure to use the scrolling arrows, which will appear if there are more images that aren't shown in the slider.</p>
                        {{ render(controller("AppBundle:Staff:imageThumbnails")) }}
                    </div>
                    {{ form_end(edit_form) }}
                    <hr>
                    <div class="row">
                        <div class="col-xs-12" id="new-image-message">
                        </div>
                    </div>
                    <div id="new-image-form-container">
                        <div class="well well-lg">
                        <h2><span class="glyphicon glyphicon-camera text-info"></span> New Profile Image</h2>
                        <p>For optimal display on the website, please make cover images <mark>800px wide by 916px tall</mark>. Also, images may not exceed <strong>8MB</strong> in size.</p>
                        {{ form(image_form) }}
                        </div>
                    </div>
                </div>
                <div class="panel-footer">
                    <p>
                    {% if is_granted("ROLE_STAFF_DELETE") %}
                    {{ form(delete_form) }}
                    {% endif %}
                    </p>
                </div>
            </div>
      </div>
    </div>
{% endblock %}
{% block documentReady %}
    //process new image
    $('#image_upload_form').submit(function(e){
    
        var formData = new FormData(this);
        
        ajaxObject = {
            url: '{{ path('medialibrary_upload_ajax') }}',
            type: 'POST',
            contentType: false,
            cache: false,
            processData: false,
            data: formData
        };

        $.ajax(ajaxObject)
            .success(function(data,status,xhr) {
                    console.log( status );
                    $('#new-image-form-container').hide();
                    $('#new-image-message').html('<p class="alert alert-success">The image was successfully uploaded. You can now select it from the thumbnail list above.</p>');
                    
                    $.get("{{ path("staff_image_thumbnails") }}", function(data) {
                        $("#thumbnails-list-container").html(data);
                    });
            })
            .fail(function(data,status,xhr) {
                    console.log( status );
                    $('#new-image-message').html('<p class="alert alert-danger">The image was not uploaded. Please ensure you are uploading a .JPG file not greater than 8MB in size.</p>');
            })
            .always(function(data,status,xhr) {
                    console.log( status );
            }); 
            
        return false;
    });
    
    /* For some reason this is causing the profile_image field not to be send with the form (5/23/16)
    // Uses the jQuery thumbnail scroller (http://manos.malihu.gr/jquery-thumbnail-scroller/)
    $("#thumbnail_image_list_container").mThumbnailScroller({
        axis: "x",
        type: "click-thumb",
        theme: "emulibrary"
    });
    */
    {{ parent() }}
{% endblock %}
