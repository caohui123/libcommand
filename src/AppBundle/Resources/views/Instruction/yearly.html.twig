{% extends '::base.html.twig' %}
{% block title %}Yearly Group Instruction Counts{% endblock %}
{% block body -%}
{{ dump(entities) }}
{# Variables for totaling sessions and attendance #}
{% set sessionsTotal = 0 %}
{% set attendanceTotal = 0 %}

{# Variables for keeping track of when to split up table by year #}
{% set monthCount = 0 %}
{% if year_type == 'academic' %}
    {% set changeYearAfter = 4 %}
{% elseif year_type == 'fiscal' %}
    {% set changeYearAfter = 6 %}
{% endif %}

<nav id="instruction-navigation" class="navbar">
    <ul class="nav navbar-nav navbar-right" id="search-instruction-list">
        <li class="dropdown search-instruction-dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-equalizer"></span> New Report <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="instruction-search-listitem">
                <div class="instruction-search-container" id="instruction-search-container">
                    {{ form(yearly_form) }} 
                </div>
            </li>
          </ul>
        </li>
    </ul>
</nav>

<h1 class="page-header">Group Instruction Totals for the {{ year_type|capitalize }} Year {{ year }}-{{ year +1 }}</h1>

{# Back button #}
{% set vars = {'basepath' : path('instruction')} %}
{% include 'snippets/newToolbar.html.twig' with vars %}
    
<div class="row">
    <div class="col-xs-12">
        <table class="table table-responsive table-striped">
            <thead>
                <tr>
                    <th class="success" aria-label="{{year}} records" rowspan="2"><span class="lead">{{ year }}</span></th>
                    <th class="text-center" colspan="2">100-200</th>
                    <th class="text-center" colspan="2">300-400</th>
                    <th class="text-center" colspan="2">Graduate</th>
                    <th class="text-center" colspan="2">High School</th>
                    <th class="text-center" colspan="2">Other</th>
                </tr>
                <tr>
                    <th class="text-center">Sessions</th>
                    <th class="text-center">Attendance</th>
                    <th class="text-center">Sessions</th>
                    <th class="text-center">Attendance</th>
                    <th class="text-center">Sessions</th>
                    <th class="text-center">Attendance</th>
                    <th class="text-center">Sessions</th>
                    <th class="text-center">Attendance</th>
                    <th class="text-center">Sessions</th>
                    <th class="text-center">Attendance</th>
                </tr>
            </thead>
            <tbody>
                {% for month, values in entities %}
                <tr>
                    <th>{{ month }}</th>
                    
                        {% for value in values %}
                            <td class="text-right">{{ value.sessions }}</td>
                            <td class="text-right">
                                {% if value.attendance is null %}
                                    0
                                {% else %}
                                    {{ value.attendance }}
                                    {% set attendanceTotal = attendanceTotal + value.attendance %}
                                {% endif %}
                            </td>
                            {% set sessionsTotal = sessionsTotal + value.sessions %}
                            {% set attendanceTotal = attendanceTotal + value.attendance %}
                        {% endfor %}
                </tr>
                {% if loop.index == changeYearAfter %}
                    <tr>
                        <th class="success" aria-label="{{ year + 1 }} records" rowspan="2"><span class="lead">{{ year + 1 }}</span></th>
                        <th class="text-center" colspan="2">100-200</th>
                        <th class="text-center" colspan="2">300-400</th>
                        <th class="text-center" colspan="2">Graduate</th>
                        <th class="text-center" colspan="2">High School</th>
                        <th class="text-center" colspan="2">Other</th>
                    </tr>
                    <tr>
                        <th class="text-center">Sessions</th>
                        <th class="text-center">Attendance</th>
                        <th class="text-center">Sessions</th>
                        <th class="text-center">Attendance</th>
                        <th class="text-center">Sessions</th>
                        <th class="text-center">Attendance</th>
                        <th class="text-center">Sessions</th>
                        <th class="text-center">Attendance</th>
                        <th class="text-center">Sessions</th>
                        <th class="text-center">Attendance</th>
                    </tr>
                {% endif %}
                {% endfor %}
                <tr class="info">
                    <th class="text-right">TOTALS:</th>
                    <td class="text-right"><strong>{{ sessionsTotal }}</strong></td>
                    <td class="text-right"><strong>{{ attendanceTotal }}</strong></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
{% block documentReady %} 
    initializeTablesort();

    //uses jQuery Tablesorter to sort columns for paginated results (http://tablesorter.com/)
    function initializeTablesort(){
        $('#jquerySortable_1').tablesorter({
            headers: {
                5: {
                    sorter: false
                },
                6: {
                    sorter: false
                }
            }
        });
    }

    {{ parent() }}
{% endblock %}