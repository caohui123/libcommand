{% extends '::base.html.twig' %}

{% block body -%}
    <h1>FeedbackArea edit</h1>

    {{ form(edit_form) }}

        <ul class="record_actions">
    <li>
        <a href="{{ path('feedbackarea') }}">
            Back to the list
        </a>
    </li>
    <li>{{ form(delete_form) }}</li>
</ul>
{% endblock %}

{% block documentReady %}
  //dynamically update the area's level (lvl) each time a new parent subject is picked
  $('#appbundle_feedbackarea_parent').on('change', function(event){
    var parentId = $(this).val();
    var url = "{{ path('feedbackarea_parentlvl', {'id': 'replace'}) }}";
    url = url.replace("replace", parentId); //twig runs before javascipt so the ID must be inserted after
    
    var ajaxObject = {
          type: 'GET',
          dataType: 'text', //expect plain text from the server
          url: url
        };
        
        $.ajax(ajaxObject)
          .success(function(data,status,xhr){
            //'data' is the integer id of the parent's 'lvl' field
            $('#appbundle_feedbackarea_lvl').val(parseInt(data)+1);
          })
          .fail(function(data,status,xhr){
            //the --Choose parent-- option won't have an id and will return a 404. In that case, set the value of the 'lvl' field to 0
            $('#appbundle_feedbackarea_lvl').val(0);
          })
          .always(function(data,status,xhr){console.log(status);});
  });
  {{ parent() }}
{% endblock %}
